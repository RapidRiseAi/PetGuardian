<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PetGuardian Care | Care Estimate</title>

  <!-- REVAMP_V4 -->

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Cinzel:wght@500;600;700&display=swap" rel="stylesheet">

  <style>
    /* =========================================================
      CONFIG (STYLE)
    ========================================================== */
    :root{
      --bg0:#061911;
      --bg1:#0A241A;
      --card: rgba(8, 28, 20, 0.78);
      --card2: rgba(10, 36, 26, 0.86);

      --champ:#F3E7D3;
      --stone:#CBBFAE;
      --brass:#B08D57;

      --border: rgba(176,141,87,0.22);
      --border2: rgba(176,141,87,0.38);

      --shadow: 0 26px 90px rgba(0,0,0,0.58);
      --r-xl: 28px;
      --r-lg: 22px;

      --focus: 0 0 0 3px rgba(176,141,87,0.18);

      /* IMPORTANT: your repo file is bg.jpeg */
      --bg-image: url("bg.jpeg");

      /* subtle noise overlay */
      --noise: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='240' height='240'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.75' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='240' height='240' filter='url(%23n)' opacity='.22'/%3E%3C/svg%3E");
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--champ);
      background: var(--bg0);
      overflow-x:hidden;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: geometricPrecision;
    }
    .font-lux{ font-family: Cinzel, Inter, system-ui, sans-serif; letter-spacing: .2px; }

    /* Desktop: true landscape, avoid page scroll */
    @media (min-width: 1024px){
      body{ overflow:hidden; }
    }

    /* Premium background (bg.jpeg + gradients + softened noise) */
    .bg-premium{
      min-height: 100vh;
      position: relative;
      background:
        radial-gradient(1100px 720px at 18% 0%, rgba(176,141,87,0.18), transparent 62%),
        radial-gradient(1000px 700px at 95% 20%, rgba(243,231,211,0.09), transparent 56%),
        radial-gradient(980px 980px at 45% 120%, rgba(10,36,26,0.85), transparent 60%),
        linear-gradient(180deg, rgba(0,0,0,0.28), rgba(0,0,0,0.72)),
        var(--bg-image),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      background-size: cover;
      background-position: center;
    }
    .bg-premium::before{
      content:"";
      position:absolute;
      inset:0;
      pointer-events:none;
      background-image: var(--noise);
      opacity: 0.20;                /* LOWER = less pixel feel */
      filter: blur(0.65px);         /* soften grain */
      mix-blend-mode: soft-light;   /* smoother than overlay */
    }
    .bg-premium::after{
      content:"";
      position:absolute;
      inset:-1px;
      pointer-events:none;
      background: radial-gradient(1200px 720px at 50% 18%, transparent 35%, rgba(0,0,0,0.82) 100%);
      opacity: 0.78;
    }

    .shell{
      position:relative;
      z-index: 1;
      height: 100vh;
      padding: 18px;
      display:flex;
      align-items: stretch;
      justify-content: center;
    }

    .app{
      width: min(1280px, 100%);
      height: 100%;
      border-radius: var(--r-xl);
      border: 1px solid var(--border);
      background: rgba(10,36,26,0.52);
      backdrop-filter: blur(12px);
      box-shadow: var(--shadow);
      overflow:hidden;
      display:flex;
      flex-direction: column;
      isolation: isolate;
    }

    .topbar{
      padding: 16px 18px;
      display:flex;
      align-items:flex-start;
      justify-content: space-between;
      gap: 14px;
      flex-wrap: wrap;
    }
    .brand{
      display:flex;
      align-items:center;
      gap: 12px;
      min-width: 320px;
    }
    .logo{
      width: 46px; height: 46px;
      border-radius: 18px;
      border: 1px solid var(--border);
      background: rgba(0,0,0,0.18);
      overflow:hidden;
      flex: 0 0 auto;
    }
    .logo img{ width:100%; height:100%; object-fit: cover; display:block; }

    .pill{
      display:inline-flex;
      align-items:center;
      gap: 10px;
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 12px;
      border: 1px solid rgba(176,141,87,0.32);
      background: rgba(8,28,20,0.45);
      color: rgba(203,191,174,0.95);
      white-space: nowrap;
    }
    .title{
      margin-top: 8px;
      font-size: 30px;
      line-height: 1.08;
      font-weight: 700;
    }
    .sub{
      margin-top: 4px;
      font-size: 13px;
      color: rgba(203,191,174,0.92);
    }
    #pricingStatus{ font-size: 12px; color: rgba(203,191,174,0.85); margin-top: 4px; }

    .actions{ display:flex; align-items:center; gap: 10px; flex-wrap: wrap; }
    .btn{
      border-radius: 16px;
      padding: 10px 14px;
      font-weight: 800;
      border: 1px solid rgba(176,141,87,0.45);
      background: rgba(8,28,20,0.22);
      color: var(--champ);
      cursor:pointer;
      transition: transform .16s ease, box-shadow .16s ease, background .16s ease, border-color .16s ease;
      user-select:none;
    }
    .btn:hover{ transform: translateY(-1px); }
    .btn:focus{ outline:none; box-shadow: var(--focus), 0 0 0 1px rgba(176,141,87,0.55); }
    .btn-primary{
      background: rgba(243,231,211,0.94);
      color: #071811;
      border-color: rgba(243,231,211,0.58);
    }
    .btn-ghost{
      background: rgba(8,28,20,0.42);
      border-color: rgba(176,141,87,0.55);
    }

    .divider{ height: 1px; background: rgba(176,141,87,0.18); }

    /* MAIN: landscape layout */
    .main{
      flex: 1;
      min-height: 0;
      padding: 14px 18px 18px;
      display:grid;
      grid-template-columns: 1fr 380px;
      gap: 16px;
      overflow:hidden;
    }

    /* Mobile stacks */
    @media (max-width: 1023px){
      body{ overflow:auto; }
      .shell{ height:auto; padding: 14px; }
      .app{ height:auto; }
      .main{
        grid-template-columns: 1fr;
        overflow: visible;
      }
    }

    .left{
      min-height: 0;
      display:grid;
      grid-template-rows: auto 1fr;
      gap: 14px;
      overflow:hidden;
    }

    .grid{
      min-height: 0;
      display:grid;
      grid-template-columns: 1fr 1fr;
      grid-template-rows: 1fr 1fr;
      gap: 14px;
      overflow:hidden;
    }
    @media (max-width: 1023px){
      .grid{ grid-template-columns: 1fr; grid-template-rows: auto; overflow: visible; }
    }

    .card{
      border-radius: var(--r-lg);
      border: 1px solid var(--border);
      background: var(--card);
      padding: 14px;
      overflow: visible; /* FIX clipping */
    }

    .card-title{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
      font-size: 13px;
      font-weight: 900;
    }
    .muted{ color: rgba(203,191,174,0.92); }
    .tiny{ font-size: 12px; color: rgba(203,191,174,0.86); }

    .input, select, textarea{
      width:100%;
      border-radius: 14px;
      padding: 10px 12px;
      background: rgba(8,28,20,0.58);
      border: 1px solid rgba(176,141,87,0.20);
      color: var(--champ);
      outline:none;
      transition: box-shadow .15s ease, border-color .15s ease;
      font-family: inherit;
    }
    .input:focus, select:focus, textarea:focus{
      border-color: rgba(176,141,87,0.62);
      box-shadow: var(--focus);
    }

    /* Segments */
    .seg{
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 10px;
      margin-top: 10px;
    }
    @media (max-width: 1023px){
      .seg{ grid-template-columns: 1fr; }
    }
    .seg-btn{
      border: 1px solid rgba(176,141,87,0.26);
      background: rgba(8,28,20,0.40);
      border-radius: 18px;
      padding: 12px 12px;
      text-align: left;
      cursor:pointer;
      transition: all .18s ease;
      color: var(--champ);
      position:relative;
    }
    .seg-btn.active{
      background: rgba(243,231,211,0.88);
      color: #071811;
      border-color: rgba(176,141,87,0.70);
    }
    .seg-sub{ margin-top: 4px; font-size: 12px; color: rgba(203,191,174,0.86); }
    .seg-btn.active .seg-sub{ color: rgba(7,24,17,0.72); }

    /* Slider */
    input[type="range"]{
      height: 26px;
      appearance:none;
      background: transparent;
      width: 100%;
      margin-top: 8px;
    }
    input[type="range"]::-webkit-slider-runnable-track{
      height: 7px;
      border-radius: 999px;
      background: rgba(243,231,211,0.14);
      border: 1px solid rgba(176,141,87,0.28);
    }
    input[type="range"]::-webkit-slider-thumb{
      appearance:none;
      width: 18px; height: 18px;
      border-radius: 999px;
      background: var(--brass);
      border: 2px solid rgba(243,231,211,0.95);
      margin-top: -7px;
      box-shadow: 0 10px 22px rgba(0,0,0,0.45);
    }

    /* Right quote */
    .quote{
      border-radius: var(--r-lg);
      border: 1px solid var(--border2);
      background: var(--card2);
      padding: 16px;
      display:flex;
      flex-direction: column;
      gap: 12px;
      overflow:hidden;
    }
    .quote-total{
      font-size: 44px;
      line-height: 1;
      margin-top: 4px;
    }
    .line{ height:1px; background: rgba(176,141,87,0.18); margin: 6px 0; }
    .row{ display:flex; align-items:center; justify-content: space-between; gap:10px; font-size: 13px; }
    .depositBox{
      border-radius: 18px;
      border: 1px solid rgba(176,141,87,0.20);
      background: rgba(243,231,211,0.10);
      padding: 12px;
    }
    .depositAmt{ font-size: 22px; font-weight: 900; margin-top: 4px; }

    /* Selected sitter mini panel */
    .selectedSitter{
      margin-top: 10px;
      border-radius: 18px;
      border: 1px solid rgba(176,141,87,0.20);
      background: rgba(8,28,20,0.35);
      padding: 10px;
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
    }
    .selLeft{ display:flex; align-items:center; gap: 10px; min-width: 0; }
    .avatar{
      width: 46px; height:46px;
      border-radius: 16px;
      border: 1px solid rgba(176,141,87,0.22);
      background: rgba(0,0,0,0.22);
      overflow:hidden;
      flex: 0 0 auto;
    }
    .avatar img{ width:100%; height:100%; object-fit: cover; display:block; image-rendering:auto; }
    .selText{ min-width:0; }
    .selName{ font-weight: 900; font-size: 13px; white-space: nowrap; overflow:hidden; text-overflow: ellipsis; }
    .selMeta{ font-size: 12px; color: rgba(203,191,174,0.88); white-space: nowrap; overflow:hidden; text-overflow: ellipsis; }

    /* =========================================================
      MODALS
    ========================================================== */
    .overlay{
      position: fixed;
      inset: 0;
      display:none;
      align-items:center;
      justify-content:center;
      padding: 18px;
      z-index: 2147483647;
      background: rgba(0,0,0,0.78);
    }
    .overlay.open{ display:flex; }
    .modal{
      width: min(1100px, 100%);
      border-radius: var(--r-xl);
      border: 1px solid rgba(176,141,87,0.42);
      background: #061911;
      box-shadow: 0 32px 120px rgba(0,0,0,0.72);
      overflow:hidden;
      max-height: calc(100vh - 48px);
      display:flex;
      flex-direction: column;
    }
    .modalHeader{
      padding: 14px 16px;
      display:flex;
      align-items:flex-start;
      justify-content: space-between;
      gap: 10px;
      background: linear-gradient(180deg, rgba(176,141,87,0.10), transparent);
      border-bottom: 1px solid rgba(176,141,87,0.18);
    }
    .modalBody{
      padding: 14px 16px 16px;
      overflow:auto;
    }

    /* Add-ons modal */
    .addonsGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
    }
    @media (max-width: 900px){
      .addonsGrid{ grid-template-columns: 1fr; }
    }
    .addonBlock{
      border-radius: 18px;
      border: 1px solid rgba(176,141,87,0.20);
      background: rgba(8,28,20,0.55);
      padding: 12px;
    }

    /* Sitter carousel: 3 cards modern, FIXED centering */
    .carouselWrap{
      border-radius: 22px;
      border: 1px solid rgba(176,141,87,0.22);
      background: rgba(8,28,20,0.45);
      padding: 14px;
    }
    .carouselStage{
      position: relative;
      height: 460px;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      perspective: 1200px;
    }
    @media (max-width: 700px){
      .carouselStage{ height: 560px; }
    }

    .sCard{
      position:absolute;
      left: 50%;
      top: 50%;
      width: 320px;
      border-radius: 22px;
      border: 1px solid rgba(176,141,87,0.22);
      background: rgba(10,36,26,0.92);
      box-shadow: 0 22px 70px rgba(0,0,0,0.55);
      overflow:hidden;
      transform-origin: center;
      transition: transform .28s ease, opacity .28s ease, filter .28s ease;
      cursor:pointer;
      user-select:none;
      will-change: transform;
    }
    @media (max-width: 520px){
      .sCard{ width: min(320px, 88vw); }
    }
    .sCard .img{
      width:100%;
      aspect-ratio: 4 / 5;
      background: rgba(0,0,0,0.22);
      border-bottom: 1px solid rgba(176,141,87,0.18);
      overflow:hidden;
    }
    .sCard .img img{ width:100%; height:100%; object-fit: cover; display:block; image-rendering:auto; }
    .sCard .pad{ padding: 12px; }
    .sName{ font-weight: 900; }
    .sTitle{ font-size: 12px; color: rgba(203,191,174,0.88); margin-top: 2px; }
    .sBio{ font-size: 12px; color: rgba(203,191,174,0.95); margin-top: 10px; line-height: 1.35; min-height: 52px; }
    .badgeRow{ display:flex; gap:8px; flex-wrap: wrap; margin-top: 10px; }
    .badge{
      font-size: 11px;
      padding: 6px 9px;
      border-radius: 999px;
      border: 1px solid rgba(176,141,87,0.22);
      background: rgba(8,28,20,0.45);
      color: rgba(203,191,174,0.95);
      white-space: nowrap;
    }
    .carouselNav{
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 10px;
      margin-top: 12px;
      flex-wrap: wrap;
    }
    .dotRow{ display:flex; gap: 8px; justify-content:center; margin-top: 10px; }
    .dot{
      width: 7px; height: 7px;
      border-radius: 999px;
      background: rgba(243,231,211,0.22);
      border: 1px solid rgba(176,141,87,0.20);
      cursor:pointer;
    }
    .dot.active{
      background: rgba(176,141,87,0.88);
      border-color: rgba(176,141,87,0.55);
    }

    /* hidden legacy node used by existing checks */
    #staffCarousel{ display:none; }
  </style>
</head>

<body class="bg-premium">
  <div class="shell">
    <div class="app">

      <div class="topbar">
        <div class="brand">
          <div class="logo">
            <img src="logo.png" alt="PetGuardian Care" onerror="this.style.display='none'">
          </div>
          <div>
            <div class="pill">PetGuardian Care <span style="color:var(--brass)">•</span> Premium Pricing</div>
            <div class="title font-lux">Get a care cost estimate</div>
            <div class="sub">Transparent pricing. Verified sitters. Secure booking.</div>
            <div id="pricingStatus">Pricing: loading from sheet…</div>
          </div>
        </div>

        <div class="actions">
          <button id="howBtn" class="btn btn-ghost" type="button">How pricing works</button>
          <button id="copyBtn" class="btn btn-primary" type="button">Copy Quote</button>
          <button id="requestBtn" class="btn" type="button">Request Booking</button>
        </div>
      </div>

      <div class="divider"></div>

      <div class="main">
        <div class="left">
          <!-- Stay type -->
          <div class="card">
            <div class="card-title">
              <span>1) Choose your stay type</span>
              <span class="tiny muted">Add-ons apply on top</span>
            </div>

            <div class="seg">
              <button class="seg-btn" data-pkg="day" type="button">
                <div style="font-weight:900;">Day Visits</div>
                <div class="seg-sub">Hourly care (you set hours)</div>
              </button>

              <button class="seg-btn" data-pkg="night" type="button">
                <div style="font-weight:900;">Overnight</div>
                <div class="seg-sub">6pm to 6am</div>
              </button>

              <button class="seg-btn" data-pkg="full" type="button">
                <div style="font-weight:900;">Full-time</div>
                <div class="seg-sub">24h presence</div>
              </button>
            </div>

            <div id="hoursWrap" style="margin-top: 12px; display:none;">
              <div style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
                <div>
                  <div style="font-weight:900; font-size: 13px;">Hours per day</div>
                  <div class="tiny muted">Only used for Day Visits</div>
                </div>
                <div style="font-size: 13px;"><span class="muted">Hours:</span> <span id="hoursOut" style="font-weight:900;">4</span></div>
              </div>
              <input id="hours" type="range" min="1" max="12" value="4">
            </div>
          </div>

          <!-- Landscape grid -->
          <div class="grid">
            <!-- When and where -->
            <div class="card">
              <div class="card-title">
                <span>2) When and where?</span>
                <span class="tiny"><span class="muted">Days:</span> <span id="daysOut" style="font-weight:900;">1</span></span>
              </div>

              <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
                <div>
                  <div class="tiny muted">Start date</div>
                  <input id="startDate" type="date" class="input">
                </div>
                <div>
                  <div class="tiny muted">End date</div>
                  <input id="endDate" type="date" class="input">
                </div>
              </div>

              <div style="margin-top: 10px;">
                <div class="tiny muted">Zone</div>
                <select id="zone">
                  <option value="sabie">Sabie (Zone A)</option>
                  <option value="wr">White River (Zone B)</option>
                  <option value="nel">Nelspruit (Zone C)</option>
                </select>
              </div>

              <div id="peakNote" class="tiny muted" style="margin-top: 10px;"></div>
            </div>

            <!-- Pets -->
            <div class="card">
              <div class="card-title">
                <span>3) Tell us about your pets</span>
                <span id="staffStatus" class="tiny muted">Loading…</span>
              </div>

              <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
                <div>
                  <div class="tiny muted">Dogs</div>
                  <input id="dogs" type="number" min="0" value="1" class="input">
                </div>
                <div>
                  <div class="tiny muted">Cats</div>
                  <input id="cats" type="number" min="0" value="0" class="input">
                </div>
              </div>

              <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
                <label class="addonBlock" style="display:flex; align-items:center; justify-content:space-between; gap:10px; margin:0;">
                  <div>
                    <div style="font-weight:900; font-size: 13px;">Puppy care</div>
                    <div class="tiny muted">Extra supervision</div>
                  </div>
                  <input id="puppy" type="checkbox">
                </label>

                <label class="addonBlock" style="display:flex; align-items:center; justify-content:space-between; gap:10px; margin:0;">
                  <div>
                    <div style="font-weight:900; font-size: 13px;">Oral meds</div>
                    <div class="tiny muted">Follow instructions</div>
                  </div>
                  <input id="meds" type="checkbox">
                </label>
              </div>

              <label class="addonBlock" style="display:flex; align-items:center; justify-content:space-between; gap:10px; margin-top: 10px;">
                <div>
                  <div style="font-weight:900; font-size: 13px;">Food supplies allowed</div>
                  <div class="tiny muted">Deduct R50 per day</div>
                </div>
                <input id="foodSupplies" type="checkbox">
              </label>
            </div>

            <!-- Add-ons + sitter -->
            <div class="card">
              <div class="card-title">
                <span>4) Add-ons and sitter</span>
                <span class="tiny muted">No scroll on desktop</span>
              </div>

              <div style="display:flex; gap: 10px; flex-wrap: wrap; margin-top: 10px;">
                <button id="openAddonsBtn" class="btn btn-primary" type="button">Customize Add-ons</button>
                <button id="openSitterBtn" class="btn btn-ghost" type="button">Choose sitter</button>
              </div>

              <div class="selectedSitter" id="selectedSitterPanel">
                <div class="selLeft">
                  <div class="avatar" id="selAvatar"></div>
                  <div class="selText">
                    <div class="selName" id="selName">No sitter selected</div>
                    <div class="selMeta" id="selMeta">Selection required to submit</div>
                  </div>
                </div>
                <button id="changeSitterBtn" class="btn" type="button" style="padding:8px 10px;">Change</button>
              </div>

              <div class="tiny muted" id="addonsSummary" style="margin-top: 10px;">Add-ons: none selected yet</div>

              <div id="staffCarousel"></div>
            </div>

            <!-- Safety card (fills the grid, keeps luxury layout tight) -->
            <div class="card">
              <div class="card-title">
                <span>Safety and transparency</span>
                <span class="tiny muted">Premium standard</span>
              </div>
              <div class="tiny muted" style="margin-top:10px; line-height:1.55;">
                • Verified sitter selection required<br>
                • Peak dates and discounts auto apply<br>
                • Deposit secures booking, balance after service<br>
                • Final price confirmed after screening and availability
              </div>
            </div>
          </div>
        </div>

        <!-- Quote -->
        <div class="quote">
          <div class="tiny muted">Your care quote</div>
          <div id="totalOut" class="quote-total font-lux">R0</div>

          <div class="line"></div>

          <div class="row"><span class="muted">Base stay</span><strong id="baseOut">R0</strong></div>
          <div class="row"><span class="muted">Add-ons + travel</span><strong id="addonsOut">R0</strong></div>
          <div class="row"><span class="muted">Long-stay discount</span><strong id="discountOut">R0</strong></div>
          <div class="row"><span class="muted">One-time fees</span><strong id="oneTimeOut">R0</strong></div>

          <div id="peakAppliedOut" class="tiny muted" style="margin-top: 6px;"></div>

          <div class="depositBox">
            <div class="tiny muted">Deposit required</div>
            <div class="depositAmt" id="depositOut">R0</div>
            <div class="tiny muted" style="margin-top: 10px;">Balance after service</div>
            <div class="depositAmt" id="balanceOut">R0</div>
            <div class="tiny muted" style="margin-top: 10px;">
              50% deposit secures booking. Remaining 50% due after service.
            </div>
          </div>

          <div class="tiny muted" style="line-height:1.5;">
            Final price confirmed after screening and availability.
          </div>

          <button class="btn btn-primary" type="button" id="requestBtn2">Request Booking</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ADD-ONS MODAL -->
  <div id="addonsOverlay" class="overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modalHeader">
        <div>
          <div class="pill">PetGuardian Care <span style="color:var(--brass)">•</span> Add-ons</div>
          <div class="title font-lux" style="font-size: 22px; margin-top: 8px;">Customize add-ons</div>
          <div class="tiny muted">Close when done. Quote updates instantly.</div>
        </div>
        <button id="closeAddonsBtn" class="btn btn-ghost" type="button">Close</button>
      </div>

      <div class="modalBody">
        <div class="addonsGrid">
          <div class="addonBlock">
            <div class="card-title"><span>Daily update packs</span><span class="tiny">Qty: <b id="updatesOut">0</b></span></div>
            <div class="tiny muted" style="margin-top:6px;">Photos plus a short written log.</div>
            <input id="updates" type="range" min="0" max="2" step="1" value="0">
          </div>

          <div class="addonBlock">
            <div class="card-title"><span>Check-ins per day</span><span class="tiny">Qty: <b id="checkinsOut">0</b></span></div>
            <div class="tiny muted" style="margin-top:6px;">Short visit for feed, water, toilet check, quick play.</div>
            <input id="checkins" type="range" min="0" max="3" step="1" value="0">
          </div>

          <div class="addonBlock" style="grid-column: 1 / -1;">
            <div class="card-title">
              <span>Walk time per day</span>
              <span class="tiny">Minutes: <b id="walkMinOut">0</b> | Cost/day: <b id="walkCostOut">R0</b></span>
            </div>
            <div class="tiny muted" style="margin-top:6px;">Single slider, 5 minute steps. R5 per 5 minutes.</div>
            <input id="walkMinutes" type="range" min="0" max="180" step="5" value="0">
          </div>

          <label class="addonBlock" style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
            <div>
              <div style="font-weight:900;">Home care pack</div>
              <div class="tiny muted">Bins, lights, basic tidy, quick checks</div>
            </div>
            <input id="homecare" type="checkbox">
          </label>

          <div class="addonBlock">
            <div class="tiny muted">Key trips (one-time)</div>
            <input id="keys" type="number" min="0" value="0" class="input" style="margin-top:6px;">
          </div>

          <div class="addonBlock">
            <div class="tiny muted">Pet taxi (one-time)</div>
            <input id="taxi" type="number" min="0" value="0" class="input" style="margin-top:6px;">
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- SITTER MODAL -->
  <div id="sitterOverlay" class="overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modalHeader">
        <div>
          <div class="pill">PetGuardian Care <span style="color:var(--brass)">•</span> Sitters</div>
          <div class="title font-lux" style="font-size: 22px; margin-top: 8px;">Choose your sitter</div>
          <div class="tiny muted">3-card carousel. Center is focus. Click center to select.</div>
        </div>
        <button id="closeSitterBtn" class="btn btn-ghost" type="button">Close</button>
      </div>

      <div class="modalBody">
        <div class="carouselWrap">
          <div class="carouselStage" id="carouselStage"></div>

          <div class="carouselNav">
            <button id="prevSitter" class="btn btn-ghost" type="button">Prev</button>
            <button id="selectSitter" class="btn btn-primary" type="button">Select Center</button>
            <button id="nextSitter" class="btn btn-ghost" type="button">Next</button>
          </div>

          <div class="dotRow" id="dotRow"></div>

          <div id="sitterEmpty" class="tiny muted" style="display:none; text-align:center; margin-top: 10px;">
            No sitters available for these dates.
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- HOW PRICING WORKS MODAL -->
  <div id="howOverlay" class="overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" style="width:min(820px,100%);">
      <div class="modalHeader">
        <div>
          <div class="pill">PetGuardian Care <span style="color:var(--brass)">•</span> Transparency</div>
          <div class="title font-lux" style="font-size: 22px; margin-top: 8px;">How pricing works</div>
          <div class="tiny muted">Clear rules. No surprises.</div>
        </div>
        <button id="closeHowBtn" class="btn btn-ghost" type="button">Close</button>
      </div>
      <div class="modalBody">
        <div class="addonBlock">
          <div style="font-weight:900;">Peak dates</div>
          <div class="tiny muted" style="margin-top:6px;">Peak multiplier applies if any day falls in peak range.</div>
          <div class="tiny muted" style="margin-top:8px; line-height:1.55;">
            June 1 to July 31<br>
            December 1 to January 15
          </div>
        </div>

        <div style="height:12px;"></div>

        <div class="addonBlock">
          <div style="font-weight:900;">Long-stay discount</div>
          <div class="tiny muted" style="margin-top:6px;">
            Blocks of 10 days: first 10 days at 100%, next 10 at 90%, next 10 at 81%. After that it stays at 81%.
          </div>
        </div>

        <div style="height:12px;"></div>

        <div class="addonBlock">
          <div style="font-weight:900;">Deposit</div>
          <div class="tiny muted" style="margin-top:6px;">50% deposit secures booking. Remaining 50% due after service.</div>
        </div>
      </div>
    </div>
  </div>

  <!-- BOOKING MODAL -->
  <div id="bookingOverlay" class="overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" style="width:min(760px,100%);">
      <div class="modalHeader">
        <div>
          <div class="pill">PetGuardian Care <span style="color:var(--brass)">•</span> Booking</div>
          <div class="title font-lux" style="font-size: 22px; margin-top: 8px;">Request booking</div>
          <div class="tiny muted">We will email an invoice or estimate. Deposit required is 50%.</div>
        </div>
        <button id="closeBookingBtn" class="btn btn-ghost" type="button">Close</button>
      </div>

      <div class="modalBody">
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 12px;">
          <div>
            <div class="tiny muted">Full name</div>
            <input id="custName" class="input" placeholder="Your name">
          </div>
          <div>
            <div class="tiny muted">Phone</div>
            <input id="custPhone" class="input" placeholder="e.g. 081 532 8774">
          </div>
          <div style="grid-column: 1 / -1;">
            <div class="tiny muted">Email</div>
            <input id="custEmail" class="input" placeholder="you@example.com">
          </div>
          <div style="grid-column: 1 / -1;">
            <div class="tiny muted">Address or area</div>
            <input id="custAddress" class="input" placeholder="Street or area">
          </div>
          <div style="grid-column: 1 / -1;">
            <div class="tiny muted">Notes</div>
            <textarea id="custNotes" rows="3" class="input" placeholder="Routine, meds, temperament, gate access, etc."></textarea>
          </div>

          <div style="display:none;">
            <input id="hpField" class="input" placeholder="Leave blank">
          </div>
        </div>

        <div class="addonBlock" style="margin-top: 12px;">
          <div class="tiny muted">Summary</div>
          <div id="modalSummary" style="margin-top:8px; font-size: 13px; color: rgba(203,191,174,0.96);"></div>
        </div>

        <div style="display:flex; align-items:center; justify-content:space-between; gap: 10px; margin-top: 12px; flex-wrap: wrap;">
          <div class="tiny muted">By requesting, you agree to deposit terms.</div>
          <button id="submitBooking" class="btn btn-primary" type="button">Send Request</button>
        </div>

        <div id="submitStatus" class="tiny muted" style="margin-top: 10px;"></div>
      </div>
    </div>
  </div>

<script>
  /* =========================================================
    CONFIG (FUNCTIONAL)
  ========================================================== */
  const CONFIG = {
    businessName: "PetGuardian Care",
    depositPercent: 0.50,
    apiBaseUrl: "https://script.google.com/macros/s/AKfycbzfqeIQFLpa155Gf-454kbaSQUEw9RpiqISwnPbSkfYPV-aU6LZlbTbkG5jv-sHe6jp/exec",
    apiKey: ""
  };

  const PRICES = {
    base: { dayHourly: 60, night: 150, fullDay: 320 },
    travelPerDay: { sabie: 0, wr: 30, nel: 60 },
    peakMultiplier: 1.15,

    add: {
      updatePackPerDay: 50,
      checkin: 50,
      walkPerMinute: 1,
      medsPerDay: 50,
      puppyCarePerDay: 100,
      homecarePerDay: 30,
      foodSuppliesCreditPerDay: 50,
      extraDogPerDay: 50,
      extraCatPerDay: 30,
      keyTrip: 50,
      petTaxi: 150
    },

    longStay: { blockDays: 10, factor: 0.9 }
  };

  let pkg = "day";
  let selectedStaff = null;
  let lastAvailabilityReqId = 0;

  let staffListCache = [];
  let carouselIndex = 0;

  const el = (id) => document.getElementById(id);

  function money(n){
    const v = Math.round(Number(n) || 0);
    return "R" + v.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
  }
  function escapeHtml(str) {
    return String(str || "").replace(/[&<>"']/g, (m) => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
    }[m]));
  }

  function daysBetween(start, end) {
    if (!start || !end) return 1;
    const s = new Date(start);
    const e = new Date(end);
    const diff = Math.round((e - s) / (1000*60*60*24)) + 1;
    return Math.max(1, diff);
  }

  function isPeakDate(dateObj){
    const m = dateObj.getMonth();
    const d = dateObj.getDate();
    if (m === 5 || m === 6) return true;
    if (m === 11) return true;
    if (m === 0 && d <= 15) return true;
    return false;
  }

  function bookingHasPeak(startStr, endStr){
    if (!startStr || !endStr) return false;
    const s = new Date(startStr);
    const e = new Date(endStr);
    s.setHours(0,0,0,0);
    e.setHours(0,0,0,0);
    for (let dt = new Date(s); dt <= e; dt.setDate(dt.getDate()+1)){
      if (isPeakDate(dt)) return true;
    }
    return false;
  }

  function weightedDays(days) {
    const { blockDays, factor } = PRICES.longStay;
    const blocks = Math.floor(days / blockDays);
    const rem = days % blockDays;
    if (blocks === 0) return days;
    const series = blockDays * (1 - Math.pow(factor, blocks)) / (1 - factor);
    return series + rem * Math.pow(factor, blocks);
  }

  function includedPetCount(dogs, cats) {
    if (dogs > 0) return { incDogs: 1, incCats: 0 };
    if (cats > 0) return { incDogs: 0, incCats: 1 };
    return { incDogs: 0, incCats: 0 };
  }

  function pkgLabel() {
    if (pkg === "day") return "Day Visits";
    if (pkg === "night") return "Overnight";
    return "Full-time";
  }
  function zoneLabel() {
    return el("zone").selectedOptions[0].textContent;
  }

  function setPkgUI() {
    document.querySelectorAll(".seg-btn").forEach(b => {
      b.classList.toggle("active", b.dataset.pkg === pkg);
    });
    el("hoursWrap").style.display = (pkg === "day") ? "block" : "none";
  }

  function openOverlay(id){
    el(id).classList.add("open");
    document.body.style.overflow = "hidden";
  }
  function closeOverlay(id){
    el(id).classList.remove("open");
    if (window.matchMedia("(min-width: 1024px)").matches) {
      document.body.style.overflow = "hidden";
    } else {
      document.body.style.overflow = "auto";
    }
  }

  window.pgPricingCallback = function(payload){
    if (!payload || payload.ok !== true) {
      el("pricingStatus").textContent = "Pricing: using defaults (Pricing tab not found)";
      calc();
      return;
    }
    applyPricingFromSheet(payload.pricing || {});
    el("pricingStatus").textContent = "Pricing: loaded from sheet";
    calc();
  };

  function applyPricingFromSheet(p){
    const num = (v, fallback) => {
      const n = Number(v);
      return Number.isFinite(n) ? n : fallback;
    };

    PRICES.base.dayHourly = num(p.BASE_DAY_HOURLY, PRICES.base.dayHourly);
    PRICES.base.night = num(p.BASE_NIGHT, PRICES.base.night);
    PRICES.base.fullDay = num(p.BASE_FULLDAY, PRICES.base.fullDay);

    PRICES.travelPerDay.sabie = num(p.TRAVEL_SABIE, PRICES.travelPerDay.sabie);
    PRICES.travelPerDay.wr = num(p.TRAVEL_WR, PRICES.travelPerDay.wr);
    PRICES.travelPerDay.nel = num(p.TRAVEL_NEL, PRICES.travelPerDay.nel);

    PRICES.peakMultiplier = num(p.PEAK_MULTIPLIER, PRICES.peakMultiplier);

    PRICES.longStay.blockDays = num(p.DISCOUNT_BLOCK_DAYS, PRICES.longStay.blockDays);
    PRICES.longStay.factor = num(p.DISCOUNT_FACTOR, PRICES.longStay.factor);

    PRICES.add.updatePackPerDay = num(p.ADD_UPDATE_PACK_PER_DAY, PRICES.add.updatePackPerDay);
    PRICES.add.checkin = num(p.ADD_CHECKIN, PRICES.add.checkin);

    PRICES.add.medsPerDay = num(p.ADD_ORAL_MEDS_PER_DAY, PRICES.add.medsPerDay);
    PRICES.add.puppyCarePerDay = num(p.ADD_PUPPY_CARE_PER_DAY, PRICES.add.puppyCarePerDay);
    PRICES.add.homecarePerDay = num(p.ADD_HOMECARE_PER_DAY, PRICES.add.homecarePerDay);
    PRICES.add.foodSuppliesCreditPerDay = num(p.ADD_FOOD_SUPPLIES_CREDIT_PER_DAY, PRICES.add.foodSuppliesCreditPerDay);

    PRICES.add.extraDogPerDay = num(p.ADD_EXTRA_DOG_PER_DAY, PRICES.add.extraDogPerDay);
    PRICES.add.extraCatPerDay = num(p.ADD_EXTRA_CAT_PER_DAY, PRICES.add.extraCatPerDay);

    PRICES.add.keyTrip = num(p.ADD_KEYTRIP_ONE_TIME, PRICES.add.keyTrip);
    PRICES.add.petTaxi = num(p.ADD_PETTAXI_ONE_TIME, PRICES.add.petTaxi);
  }

  function fetchPricing(){
    if (!CONFIG.apiBaseUrl) return;
    const old = document.getElementById("jsonpPricing");
    if (old) old.remove();

    const url = new URL(CONFIG.apiBaseUrl);
    url.searchParams.set("action", "pricing");
    url.searchParams.set("reqId", String(Date.now()));
    url.searchParams.set("callback", "pgPricingCallback");
    if (CONFIG.apiKey) url.searchParams.set("apiKey", CONFIG.apiKey);

    const script = document.createElement("script");
    script.id = "jsonpPricing";
    script.src = url.toString();
    script.onerror = () => { el("pricingStatus").textContent = "Pricing: using defaults (could not load)"; calc(); };
    document.body.appendChild(script);
  }

  window.pgAvailabilityCallback = function(payload) {
    if (!payload || payload.reqId != lastAvailabilityReqId) return;
    const list = payload.staff || [];

    staffListCache = list.slice();
    el("staffStatus").textContent = list.length ? "Select a sitter" : "None available";
    el("sitterEmpty").style.display = list.length ? "none" : "block";

    if (selectedStaff) {
      const stillThere = staffListCache.find(s => String(s.id) === String(selectedStaff.id));
      if (!stillThere) selectedStaff = null;
    }

    renderStaffCarouselLegacy(list);
    initCarousel();
    updateSelectedSitterPanel();
  };

  function fetchAvailability() {
    if (!CONFIG.apiBaseUrl) {
      el("staffStatus").textContent = "API not connected";
      return;
    }
    el("staffStatus").textContent = "Checking…";

    const start = el("startDate").value;
    const end = el("endDate").value;
    const zone = el("zone").value;

    lastAvailabilityReqId += 1;
    const reqId = lastAvailabilityReqId;

    const old = document.getElementById("jsonpAvail");
    if (old) old.remove();

    const url = new URL(CONFIG.apiBaseUrl);
    url.searchParams.set("action", "availability");
    url.searchParams.set("start", start);
    url.searchParams.set("end", end);
    url.searchParams.set("pkg", pkg);
    url.searchParams.set("zone", zone);
    url.searchParams.set("reqId", String(reqId));
    url.searchParams.set("callback", "pgAvailabilityCallback");
    if (CONFIG.apiKey) url.searchParams.set("apiKey", CONFIG.apiKey);

    const script = document.createElement("script");
    script.id = "jsonpAvail";
    script.src = url.toString();
    script.onerror = () => el("staffStatus").textContent = "Could not load availability";
    document.body.appendChild(script);
  }

  function renderStaffCarouselLegacy(staffList) {
    const wrap = el("staffCarousel");
    wrap.innerHTML = "";
    staffList.forEach((s) => {
      const node = document.createElement("div");
      node.textContent = s.name || "";
      wrap.appendChild(node);
    });
  }

  /* =========================
    Carousel (FIXED centering + spacing + z-index)
  ========================== */
  function initCarousel(){
    carouselIndex = 0;
    if (selectedStaff){
      const idx = staffListCache.findIndex(s => String(s.id) === String(selectedStaff.id));
      if (idx >= 0) carouselIndex = idx;
    }
    renderCarousel();
  }

  function setCarouselIndex(i){
    if (!staffListCache.length) return;
    const n = staffListCache.length;
    carouselIndex = (i % n + n) % n;
    renderCarousel();
  }

  function renderCarousel(){
    const stage = el("carouselStage");
    const dots = el("dotRow");
    stage.innerHTML = "";
    dots.innerHTML = "";

    if (!staffListCache.length) return;

    staffListCache.forEach((_, i) => {
      const d = document.createElement("div");
      d.className = "dot" + (i === carouselIndex ? " active" : "");
      d.addEventListener("click", () => setCarouselIndex(i));
      dots.appendChild(d);
    });

    const n = staffListCache.length;
    const prev = staffListCache[(carouselIndex - 1 + n) % n];
    const curr = staffListCache[carouselIndex];
    const next = staffListCache[(carouselIndex + 1) % n];

    const stageW = stage.clientWidth || 1000;
    const shift = Math.min(380, Math.max(260, Math.round(stageW * 0.28))); /* responsive spacing */

    const cards = [
      { data: prev, diff: -1 },
      { data: curr, diff: 0 },
      { data: next, diff: 1 },
    ];

    cards.forEach(({data, diff}) => {
      const card = document.createElement("div");
      card.className = "sCard";

      const x = diff * shift;
      const scale = diff === 0 ? 1.0 : 0.90;
      const rot = diff === 0 ? 0 : (diff > 0 ? -12 : 12);
      const opa = diff === 0 ? 1.0 : 0.62;

      /* z-index so center always on top */
      card.style.zIndex = diff === 0 ? "3" : (diff < 0 ? "2" : "1");
      card.style.opacity = String(opa);

      /* IMPORTANT: center anchor */
      card.style.transform = `translate(-50%, -50%) translateX(${x}px) scale(${scale}) rotateY(${rot}deg)`;

      card.innerHTML = `
        <div class="img">
          <img src="${escapeHtml(data.photoUrl || "")}" alt="${escapeHtml(data.name || "Sitter")}">
        </div>
        <div class="pad">
          <div class="sName font-lux">${escapeHtml(data.name || "Sitter")}</div>
          <div class="sTitle">${escapeHtml(data.title || "PetGuardian Care Sitter")} · Rating ${escapeHtml(String(data.rating || "5.0"))}</div>
          <div class="sBio">${escapeHtml(data.bio || "Professional sitter")}</div>
          <div class="badgeRow">
            <span class="badge">Verified</span>
            <span class="badge">ID checked</span>
            <span class="badge">Background check</span>
          </div>
        </div>
      `;

      card.addEventListener("click", () => {
        if (diff === 0){
          selectedStaff = data;
          updateSelectedSitterPanel();
          closeOverlay("sitterOverlay");
        } else {
          setCarouselIndex(carouselIndex + diff);
        }
      });

      stage.appendChild(card);
    });
  }

  function updateSelectedSitterPanel(){
    const avatar = el("selAvatar");
    const name = el("selName");
    const meta = el("selMeta");

    if (!staffListCache.length){
      avatar.innerHTML = "";
      name.textContent = "No sitters available";
      meta.textContent = "Try different dates or stay type";
      return;
    }
    if (!selectedStaff){
      avatar.innerHTML = "";
      name.textContent = "No sitter selected";
      meta.textContent = "Selection required to submit";
      return;
    }

    avatar.innerHTML = `<img src="${escapeHtml(selectedStaff.photoUrl || "")}" alt="${escapeHtml(selectedStaff.name || "Sitter")}">`;
    name.textContent = selectedStaff.name || "Selected sitter";
    meta.textContent = (selectedStaff.title || "PetGuardian Care Sitter") + " · Rating " + (selectedStaff.rating || "5.0");
  }

  function calc() {
    const start = el("startDate").value;
    const end = el("endDate").value;
    const days = daysBetween(start, end);
    el("daysOut").textContent = days;

    const zone = el("zone").value;
    const travel = Number(PRICES.travelPerDay[zone] || 0);

    const peakApplied = bookingHasPeak(start, end);
    const peakMult = peakApplied ? PRICES.peakMultiplier : 1;

    el("peakNote").textContent = peakApplied ? "Peak pricing applied automatically." : "No peak dates detected.";
    el("peakAppliedOut").textContent = peakApplied
      ? "Peak dates detected in your booking range."
      : "No peak dates detected in your booking range.";

    const wDays = weightedDays(days);

    const dogs = Math.max(0, parseInt(el("dogs").value || "0", 10));
    const cats = Math.max(0, parseInt(el("cats").value || "0", 10));
    const { incDogs, incCats } = includedPetCount(dogs, cats);
    const extraDogs = Math.max(0, dogs - incDogs);
    const extraCats = Math.max(0, cats - incCats);

    const hours = parseInt(el("hours").value || "1", 10);
    el("hoursOut").textContent = hours;

    const updates = parseInt(el("updates").value || "0", 10);
    el("updatesOut").textContent = updates;

    const checkins = parseInt(el("checkins").value || "0", 10);
    el("checkinsOut
